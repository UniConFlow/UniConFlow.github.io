<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.2">
  <title>UniConFlow</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="./static/css/index.css">
</head>
<body>

  <!-- Navigation -->
  <nav class="navbar" id="navbar">
    <div class="container nav-container">
      <a href="#" class="nav-logo">UniConFlow</a>
      <div class="nav-links">
        <a href="#overview">Overview</a>
        <a href="#demo-pendulum">Pendulum</a>
        <a href="#demo-car">Car Racing</a>
        <a href="#demo-manipulator">Manipulator</a>
        <a href="#results">Results</a>
      </div>
    </div>
  </nav>

    <!-- Section 1: Hero -->
  <section class="bg-white">
    <div class="container hero-content">
      <div class="hero-text">
        <h1 class="fade-in-up">UniConFlow:<br>Unified Constrained Flow Matching for Certified Motion Planning</h1>
        <p class="hero-subtitle fade-in-up delay-100">
          A unified generative framework that systematically enforces safety, dynamic consistency, and action feasibility constraints in robot motion planning via prescribed-time guidance.
        </p>
        
        <div class="tags fade-in-up delay-300">
          <span class="tag">Generative Model</span>
          <span class="tag">Flow Matching</span>
          <span class="tag">Motion Planning</span>
          <span class="tag">Safety Guarantee</span>
          <span class="tag">Physical Feasibility</span>
          <span class="tag">Kinodynamic Consistency</span>
        </div>
        
        <div class="buttons fade-in-up delay-300">
          <!-- Buttons hidden for anonymity -->
        </div>
      </div>
      
      <div class="hero-visual fade-in delay-200" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:0.75rem;">
        <div class="hero-figure">
          <img id="hero-gif-0" src="assets/images/hero_placeholder.gif" alt="UniConFlow Teaser 1" onerror="this.src='https://via.placeholder.com/800x450?text=Hero+GIF'">
        </div>
        <div class="hero-figure">
          <img id="hero-gif-1" src="assets/images/hero_placeholder.gif" alt="UniConFlow Teaser 2" onerror="this.src='https://via.placeholder.com/800x450?text=Hero+GIF'">
        </div>
        <div class="hero-figure">
          <img id="hero-gif-2" src="assets/images/hero_placeholder.gif" alt="UniConFlow Teaser 3" onerror="this.src='https://via.placeholder.com/800x450?text=Hero+GIF'">
        </div>
      </div>
    </div>
  </section>

  <!-- Section 2: Short Overview -->
  <section id="overview" class="section-bg">
    <div class="container" data-animate>
      <!-- Text Part -->
      <div class="overview-content" style="margin-bottom: 3rem;">
        <h2 class="text-center" style="margin-bottom: 2rem;">Overview</h2>
        <div class="overview-text">
          <p>
            Generative models have become powerful tools for robot motion generation, enabling flexible and multimodal trajectory generation. Yet, most existing approaches remain limited in handling multiple types of constraints—such as collision avoidance, actuation limits, and dynamic consistency—often addressing them heuristically or individually.
          </p>
          <p>
            In this work, we propose <strong class="text-main">UniConFlow</strong>, a unified constrained flow matching-based framework that systematically incorporates both equality and inequality constraints. UniConFlow introduces a novel <em>prescribed-time zeroing function (PTZF)</em> that shapes a time-varying guidance field during inference, enabling the generation process to adapt to varying system models and task requirements without retraining.
          </p>
          <p>
            To further address computational challenges in long-horizon and high-dimensional tasks, we introduce two practical strategies: a <strong>violation-segment extraction protocol</strong> for precise refinement and a <strong>trajectory compression method</strong>. Empirical validation on double inverted pendulum, car racing, and manipulation tasks demonstrates that UniConFlow outperforms state-of-the-art generative planners in safety, kinodynamic consistency, and action feasibility.
          </p>
        </div>
      </div>

      <!-- Table Part -->
      <div class="comparison-table-container">
        <h3 class="text-center" style="margin-bottom: 1.5rem;">Comparison with State-of-the-Art Generative Planners</h3>
        <div class="table-responsive">
          <table class="detailed-table" style="text-align: center;">
            <thead>
              <tr>
                <th style="text-align: left;">Method</th>
                <th>Obstacle<br>Avoidance</th>
                <th>Safety<br>Guarantee</th>
                <th>Dynamics<br>Consistency</th>
                <th>Admissible<br>Action</th>
                <th>Adaptive<br>Guidance</th>
                <th>Long-Horizon<br>Planning</th>
                <th>Dataset<br>Creation</th>
                <th>Real-world<br>Experience</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Diffuser</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>✅</td>
                <td>❌</td>
              </tr>
              <tr>
                <td>Decision Diffuser</td>
                <td>✅</td>
                <td>❌</td>
                <td>✅</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>✅</td>
                <td>❌</td>
              </tr>
              <tr>
                <td>Diffusion-based Policy</td>
                <td>❌</td>
                <td>❌</td>
                <td>⚪</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>✅</td>
                <td>✅</td>
              </tr>
              <tr>
                <td>ChainedDiffuser</td>
                <td>❌</td>
                <td>❌</td>
                <td>⚪</td>
                <td>⚪</td>
                <td>❌</td>
                <td>✅</td>
                <td>✅</td>
                <td>✅</td>
              </tr>
              <tr>
                <td>DPCA</td>
                <td>✅</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
              </tr>
              <tr>
                <td>DPCC</td>
                <td>✅</td>
                <td>❌</td>
                <td>✅</td>
                <td>✅</td>
                <td>❌</td>
                <td>❌</td>
                <td>✅</td>
                <td>❌</td>
              </tr>
              <tr>
                <td>HDP</td>
                <td>❌</td>
                <td>❌</td>
                <td>✅</td>
                <td>✅</td>
                <td>❌</td>
                <td>❌</td>
                <td>❌</td>
                <td>✅</td>
              </tr>
              <tr>
                <td>CoBL</td>
                <td>✅</td>
                <td>❌</td>
                <td>⚪</td>
                <td>⚪</td>
                <td>❌</td>
                <td>✅</td>
                <td>❌</td>
                <td>❌</td>
              </tr>
              <tr>
                <td>SafeDiffuser</td>
                <td>✅</td>
                <td>❌</td>
                <td>⚪</td>
                <td>⚪</td>
                <td>❌</td>
                <td>✅</td>
                <td>❌</td>
                <td>❌</td>
              </tr>
              <tr>
                <td>PCFM</td>
                <td>✅</td>
                <td>⚪</td>
                <td>⚪</td>
                <td>⚪</td>
                <td>❌</td>
                <td>❌</td>
                <td>✅</td>
                <td>❌</td>
              </tr>
              <tr>
                <td>SafeFlow</td>
                <td>✅</td>
                <td>✅</td>
                <td>⚪</td>
                <td>⚪</td>
                <td>❌</td>
                <td>✅</td>
                <td>✅</td>
                <td>✅</td>
              </tr>
              <tr style="background-color: #f0f9ff; font-weight: 600;">
                <td>UniConFlow (Ours)</td>
                <td>✅</td>
                <td>✅</td>
                <td>✅</td>
                <td>✅</td>
                <td>✅</td>
                <td>✅</td>
                <td>✅</td>
                <td>✅</td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="text-sm text-secondary text-center" style="margin-top: 1rem;">
          ✅ Explicitly Addressed &nbsp;&nbsp;
          ❌ Not Addressed &nbsp;&nbsp;
          ⚪ Not Applicable
        </p>
      </div>
    </div>
  </section>


  <!-- Section 4: Demo 1 - Pendulum -->
  <section id="demo-pendulum" class="section-white">
    <div class="container">
      <div class="demo-section-grid" data-animate>
        <!-- Left: Media -->
        <div>
          <div style="display:flex; gap:0.75rem; flex-wrap:wrap;">
            <div class="demo-media" style="flex:1 1 30%; cursor:pointer;" onclick="openLightbox('fig/pen-a.jpeg','Pendulum Snapshot 1')">
              <img src="fig/pen-a.jpeg" alt="Pendulum Snapshot 1">
            </div>
            <div class="demo-media" style="flex:1 1 30%; cursor:pointer;" onclick="openLightbox('fig/pen-b.jpeg','Pendulum Snapshot 2')">
              <img src="fig/pen-b.jpeg" alt="Pendulum Snapshot 2">
            </div>
            <div class="demo-media" style="flex:1 1 30%; cursor:pointer;" onclick="openLightbox('fig/pen-cc.jpeg','Pendulum Snapshot 3')">
              <img src="fig/pen-cc.jpeg" alt="Pendulum Snapshot 3">
            </div>
          </div>
          <div class="figure-caption">
            Three snapshots of the pendulum swing-up and stabilization process.
          </div>
        </div>

        <!-- Right: Text -->
        <div class="demo-content">
          <h3>Double Inverted Pendulum</h3>
          <div class="content-block">
            <p>
              We consider a double inverted pendulum consisting of two rigid links and is actuated by torques at the joints. It operates in the vertical plane under gravity.
            </p>
            <p>
              The control objective is to swing the pendulum to the upright equilibrium point from any random initial state without collision.
            </p>
            <ul style="list-style:none; padding:0; margin-top:1rem;">
              <li style="margin-bottom:0.5rem; display:flex; gap:0.5rem; align-items:flex-start;">
                <span style="margin-top:0.2rem;">✅</span>
                <span><strong>Perfect constraint satisfaction:</strong> 100% success rate with zero violations.</span>
              </li>
              <li style="margin-bottom:0.5rem; display:flex; gap:0.5rem; align-items:flex-start;">
                <span style="margin-top:0.2rem;">✅</span>
                <span><strong>Computational efficiency:</strong> Approximately 5 times faster than conventional optimization-based methods while achieving lower trajectory cost.</span>
              </li>
              <li style="margin-bottom:0.5rem; display:flex; gap:0.5rem; align-items:flex-start;">
                <span style="margin-top:0.2rem;">✅</span>
                <span><strong>Two-stage inference:</strong> PTZF-based guided sampling followed by terminal refinement.</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 5: Demo 2 - Car Racing -->
  <section id="demo-car" class="section-bg">
    <div class="container">
      <div class="demo-section-grid reverse" data-animate>
        <!-- Left: Text -->
        <div class="demo-content">
          <h3>Car Racing on Nürburgring Nordschleife</h3>
          <div class="content-block">
            <p>
              We employ a nonholonomic vehicle model to simulate the car racing task.
              The objective is to navigate from a start state to a goal state while adhering to the reference raceline, remaining within the drivable corridor, and avoiding collisions with obstacles.
            </p>
            <p>
              UniConFlow is the only method to successfully solve both forward and reverse driving tasks with perfect 100% scores across all metrics and zero constraint violations, while all baseline methods fail catastrophically.
            </p>
            
            <ul style="list-style: none; padding: 0; margin-top: 1.5rem;">
              <li style="margin-bottom: 0.5rem; display: flex; align-items: flex-start; gap: 0.5rem;">
                <span style="margin-top: 0.2rem;">✅</span>
                <span><strong>Real-to-sim environment creation:</strong> Racetrack environment constructed from Nürburgring Nordschleife data through 
                  geometric extraction and rasterization.</span>
              </li>
              <li style="margin-bottom: 0.5rem; display: flex; align-items: flex-start; gap: 0.5rem;">
                <span style="margin-top: 0.2rem;">✅</span>
                <span><strong>Three-step refinement strategy:</strong> Violation segment extraction, frozen-window refinement, and violation-window refinement with global certification.</span>
              </li>
              <li style="margin-bottom: 0.5rem; display: flex; align-items: flex-start; gap: 0.5rem;">
                <span style="margin-top: 0.2rem;">✅</span>
                <span><strong>Comprehensive validation:</strong> Forward and reverse driving experiments validate the method's effectiveness, achieving 100% success rates with zero violations in both scenarios.</span>
              </li>
            </ul>
          </div>
        </div>
        
        <!-- Right: Images -->
        <div style="display: flex; flex-direction: column; gap: 1rem;">
          <div class="demo-media" style="cursor: pointer;" onclick="openLightbox('fig/car_pipeline_illustaration.png', 'Dataset Generation Pipeline')">
            <img src="fig/car_pipeline_illustaration.png" alt="Dataset Generation Pipeline">
          </div>
          <div class="figure-caption">
            The Dataset Generation Pipeline.
          </div>
          <div class="demo-media" style="cursor: pointer;" onclick="openLightbox('fig/carref.png', 'Terminal Refinement Pipeline')">
            <img src="fig/carref.png" alt="Terminal Refinement Pipeline">
          </div>
          <div class="figure-caption">
            The Terminal Refinement Pipeline.
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 6: Demo 3 - Manipulator -->
  <section id="demo-manipulator" class="bg-white">
    <div class="container">
      <div class="demo-section-grid" data-animate>
        <!-- Left: Media -->
        <div style="display: flex; flex-direction: column; gap: 1rem;">
          <div class="demo-media" style="cursor: pointer;" onclick="openLightbox('fig/arm_real.png', 'Real Robot Experiment Setup')">
            <img src="fig/arm_real.png" alt="Real Robot Experiment Setup">
          </div>
          <div class="figure-caption">
            The experimental setup for the manipulator. The obstacle is modeled as an ellipsoid for collision avoidance purposes, with its geometric center defined by the attached marker. Marker positions are measured via an NDI Polaris Vega XT optical tracker, while the robot state is visualized in RViz.
          </div>
          <div class="demo-media" style="cursor: pointer;" onclick="openLightbox('fig/robot_pipeline.png', 'UniConFlow Robot Pipeline')">
            <img src="fig/robot_pipeline.png" alt="UniConFlow Robot Pipeline">
          </div>
          <div class="figure-caption">
            The inference pipeline for the manipulator task.
          </div>
        </div>

        <!-- Right: Text -->
        <div class="demo-content">
          <h3>7-DoF Manipulator in 3D Spatial Motion</h3>
          <div class="content-block">
            <p>
              For sim-to-real evaluation on the 7-DoF Franka Panda manipulator, 
              we first generate a training dataset in the MuJoCo simulation environment via model predictive control. 
              The generative models are trained on this dataset before deploying the resulting UniConFlow planner directly on the hardware for evaluation.
            </p>
            <p>
              This task presents significantly greater challenges than the car-racing benchmark. Due to the high control frequency (1000 Hz), the resulting state-action trajectories are both high-dimensional and long-horizon.
            </p>
            <p class="text-main">
              <strong>UniConFlow achieves 100% success rates across all metrics in both pseudo-2D and full 3D spatial motion scenarios, with costs 5-10 orders of magnitude lower than baselines while maintaining real-time performance (32-105 ms).</strong>
            </p>

            <ul style="list-style: none; padding: 0; margin-top: 1rem;">
              <li style="margin-bottom: 0.5rem; display: flex; gap: 0.5rem; align-items: flex-start;">
                <span style="margin-top: 0.2rem;">✅</span>
                <span><strong>Sim-to-real experimental scenarios:</strong> Pseudo-2D workspace for intuitive visualization and full 3D spatial motion with circular trajectories, both validated on physical hardware.</span>
              </li>
              <li style="margin-bottom: 0.5rem; display: flex; gap: 0.5rem; align-items: flex-start;">
                <span style="margin-top: 0.2rem;">✅</span>
                <span><strong>Trajectory compression:</strong> B-spline encoder-decoder representation compresses high-dimensional, long-horizon trajectories to a compact latent space, maintaining computational tractability while preserving constraint enforcement in native robot space.</span>
              </li>
              <li style="margin-bottom: 0.5rem; display: flex; gap: 0.5rem; align-items: flex-start;">
                <span style="margin-top: 0.2rem;">✅</span>
                <span><strong>Motion capture integration:</strong> NDI Polaris Vega XT optical tracker determines obstacle positions relative to the robot, enabling precise collision avoidance in real-world deployment.</span>
              </li>
              <li style="margin-bottom: 0.5rem; display: flex; gap: 0.5rem; align-items: flex-start;">
                <span style="margin-top: 0.2rem;">✅</span>
                <span><strong>Consistent superior performance:</strong> All baseline methods (vanilla generative models, guidance methods, optimization-based methods) fail catastrophically with high violations, timeouts, or infeasible trajectories, while UniConFlow maintains 100% success rate and zero violations.</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>


  <!-- Section 8.5: Qualitative Comparison -->
  <section id="results" class="section-bg-alt">
    <div class="container">
      <h2 data-animate>Results</h2>
      <p data-animate>Click on a method to view details. Switch between Image and GIF views.</p>

      <!-- Experiment Selection -->
      <div class="experiment-tabs" id="experiment-tabs" data-animate>
        <!-- Populated by JS -->
      </div>

      <!-- GIF Gallery -->
      <div class="gif-gallery" id="gif-gallery" data-animate>
        <!-- Populated by JS -->
      </div>

      <!-- Method Grid -->
      <div class="method-grid" id="method-grid" data-animate>
        <!-- Populated by JS -->
      </div>
    </div>
  </section>

  <!-- Image Modal -->
  <div id="result-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3 id="modal-title">Method Name</h3>
      
      <div class="view-toggle">
        <button class="toggle-btn active" data-type="image" onclick="setModalView('image')">Image</button>
        <button class="toggle-btn" data-type="gif" onclick="setModalView('gif')">GIF</button>
      </div>

      <div class="modal-media-container">
        <img id="modal-image" src="" alt="Result Image">
        <div id="modal-gif-placeholder" class="gif-placeholder" style="display:none;">
          <div class="placeholder-text">GIF Placeholder</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Lightbox Modal for Demo Images -->
  <div id="lightbox-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal" id="lightbox-close">&times;</span>
      <h3 id="lightbox-title"></h3>
      <div class="modal-media-container">
        <img id="lightbox-image" src="" alt="Preview">
      </div>
    </div>
  </div>

  <!-- Section 9: Detailed Quantitative Results -->
  <section id="detailed-results" class="bg-white">
    <div class="container">
      <h2 data-animate>Quantitative Results</h2>
      <p data-animate>Hover over cells to highlight row and column.</p>

      <!-- Experiment Selection for Tables -->
      <div class="experiment-tabs" id="detailed-tabs" data-animate>
        <!-- Populated by JS -->
      </div>

      <!-- Table Container -->
      <div class="table-container" id="table-container" data-animate>
        <!-- Populated by JS -->
      </div>
    </div>
  </section>

  <!-- Section 10: Code -->
  <section id="code" class="section-bg">
    <div class="container">
      <div style="max-width: 800px; margin: 0 auto;">
        <div data-animate class="text-center">
          <h3>Code</h3>
          <p class="text-secondary" style="font-size: 1.1rem; margin-top: 1rem;">
            Coming soon
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer bg-white">
    <div class="container footer-content">
      <div>&copy; 2025 UniConFlow authors.</div>
      <!-- Anonymized Institution -->
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    // Navbar Scroll Effect
    const navbar = document.getElementById('navbar');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 50) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
    });

    // Intersection Observer for Animations
    const observerOptions = {
      root: null,
      rootMargin: '0px',
      threshold: 0.1
    };

    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target); // Animate only once
        }
      });
    }, observerOptions);

    document.querySelectorAll('[data-animate]').forEach(el => {
      observer.observe(el);
    });

    // --- Qualitative Results Logic ---
    const experiments = [
      {
        id: 'pendulum',
        title: 'Pendulum',
        path: 'fig/Metric_Fig/Pendulum/',
        methods: [
          { name: 'Diffuser', file: 'Diffuser.png' },
          { name: 'Diffuser-D', file: 'Diffuser_D.png' },
          { name: 'CG', file: 'CG.png' },
          { name: 'Trunc', file: 'TRUNC.png' },
          { name: 'RoS', file: 'RoS.png' },
          { name: 'ReS', file: 'RES.png' },
          { name: 'TVS', file: 'TVS.png' },
          { name: 'CoBL', file: 'CoBL.png' },
          { name: 'FM', file: 'FM.png' },
          { name: 'PCFM', file: 'PCFM.png' },
          { name: 'FM-MPPI', file: 'FMMPPI.png' },
          { name: 'SafeFlow', file: 'SafeFlow.png' },
          { name: 'UniConFlow', file: 'UniConFlow.png' },
        ]
      },
      {
        id: 'car_forward',
        title: 'Car Racing (Forward)',
        path: 'fig/Metric_Fig/Car_Forward/',
        methods: [
          { name: 'Diffuser', gif: 'fig/gifs/car_metric/forward/Diffuser.gif' },
          { name: 'Diffuser-D', gif: 'fig/gifs/car_metric/forward/DiffuserD_denoising.gif' },
          { name: 'CG', gif: 'fig/gifs/car_metric/forward/CG_denoising.gif' },
          { name: 'Trunc', gif: 'fig/gifs/car_metric/forward/Trunc_denoising.gif' },
          { name: 'RoS', gif: 'fig/gifs/car_metric/forward/RoS_denoising.gif' },
          { name: 'ReS', gif: 'fig/gifs/car_metric/forward/ReS_denoising.gif' },
          { name: 'TVS', gif: 'fig/gifs/car_metric/forward/TVS_denoising.gif' },
          { name: 'CoBL', gif: 'fig/gifs/car_metric/forward/CoBL_denoising.gif' },
          { name: 'FM', gif: 'fig/gifs/car_metric/forward/FM_denoising.gif' },
          { name: 'PCFM', gif: 'fig/gifs/car_metric/forward/PCFM_denoising.gif' },
          { name: 'FM-MPPI', gif: 'fig/gifs/car_metric/forward/FM-MPPI_denoising.gif' },
          { name: 'SafeFlow', gif: 'fig/gifs/car_metric/forward/SafeFlow_denoising.gif' },
          { name: 'UniConFlow', gif: 'fig/gifs/car_metric/forward/UniConFlow_denoising.gif' },
        ]
      },
      {
        id: 'car_inverse',
        title: 'Car Racing (Inverse)',
        path: 'fig/Metric_Fig/Car_Inverse/',
        methods: [
           { name: 'Diffuser', gif: 'fig/gifs/car_metric/reverse/Diffuser_denoising.gif' },
           { name: 'Diffuser-D', gif: 'fig/gifs/car_metric/reverse/DiffuserD_denoising.gif' },
           { name: 'Trunc', gif: 'fig/gifs/car_metric/reverse/Trunc_denoising.gif' },
           { name: 'CG', gif: 'fig/gifs/car_metric/reverse/CG_denoising.gif' },
           { name: 'RoS', gif: 'fig/gifs/car_metric/reverse/RoS_denoising.gif' },
           { name: 'ReS', gif: 'fig/gifs/car_metric/reverse/ReS_denoising.gif' },
           { name: 'TVS', gif: 'fig/gifs/car_metric/reverse/TVS_denoising.gif' },
           { name: 'CoBL', gif: 'fig/gifs/car_metric/reverse/CoBL_denoising.gif' },
           { name: 'FM', gif: 'fig/gifs/car_metric/reverse/FM_run1_denoising.gif' },
           { name: 'PCFM', gif: 'fig/gifs/car_metric/reverse/PCFM_denoising.gif' },
           { name: 'FM-MPPI', gif: 'fig/gifs/car_metric/reverse/FM-MPPI_denoising.gif' },
           { name: 'SafeFlow', gif: 'fig/gifs/car_metric/reverse/SafeFlow_denoising.gif' },
           { name: 'UniConFlow', gif: 'fig/gifs/car_metric/reverse/UniConFlow_denoising.gif' },
        ]
      },
      {
        id: 'robot_2d',
        title: 'Manipulator (Pseudo-2D)',
        path: 'fig/Metric_Fig/Robot_2D/',
        methods: [
          { name: 'Diffuser', file: 'Diffuser.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/Diffuser.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/Diffuser_State.gif' }
          ]},
          { name: 'Diffuser-D', file: 'Diffuser-D.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/Diffuser-D.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/Diffuser-D_State.gif' }
          ]},
          { name: 'CG', file: 'CG.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/CG.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/CG_State.gif' }
          ]},
          { name: 'Trunc', file: 'Trunc.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/Trunc.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/Trunc_State.gif' }
          ]},
          { name: 'RoS', file: 'RoS.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/RoS.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/RoS_State.gif' }
          ]},
          { name: 'ReS', file: 'ReS.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/ReS.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/ReS_State.gif' }
          ]},
          { name: 'TVS', file: 'TVS.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/TVS.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/TVS_State.gif' }
          ]},
          { name: 'CoBL', file: 'CoBL.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/CoBL.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/CoBL_State.gif' }
          ]},
          { name: 'FM', file: 'FM.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/FM.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/FM_State.gif' }
          ]},
          { name: 'PCFM', file: 'NLP.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/NLP_Action.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/NLP_State.gif' }
          ]},
          { name: 'FM-MPPI', file: 'MPPI.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/MPPI_Action.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/MPPI_State.gif' }
          ]},
          { name: 'SafeFlow', file: 'SafeFlow.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/SafeFlow.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/SafeFlow_State.gif' }
          ]}, 
          { name: 'UniConFlow', file: 'UniCon.png', gifOptions: [
            { label: 'Action', src: 'fig/gifs/robot_2D/UniCon.gif' },
            { label: 'State', src: 'fig/gifs/robot_2D/UniCon_State.gif' }
          ]},
        ]
      },
      {
        id: 'robot_3d',
        title: 'Manipulator (3D)',
        path: 'fig/Metric_Fig/Robot_3D/',
        methods: [
          { name: 'UniConFlow', file: '3d_vis_UniConFlow.png' },
          { name: 'SafeFM', file: '3d_vis_SafeFM.png' },
          { name: 'FM', file: '3d_vis_FM.png' },
          { name: 'CG', file: '3d_vis_CG.png' },
          { name: 'CoBL', file: '3d_vis_CoBL.png' },
          { name: 'Diffuser', file: '3d_vis_Diffuser.png' },
          { name: 'Diffuser-D', file: '3d_vis_Diffuser-D.png' },
          { name: 'MPPI', file: '3d_vis_MPPI.png' },
          { name: 'NLP', file: '3d_vis_NLP.png' },
          { name: 'ReS', file: '3d_vis_ReS.png' },
          { name: 'RoS', file: '3d_vis_RoS.png' },
          { name: 'Trunc', file: '3d_vis_Trunc.png' },
          { name: 'TVS', file: '3d_vis_TVS.png' }
        ]
      }
    ];

    let currentExperiment = experiments[0];

    function initQualitative() {
      const tabsContainer = document.getElementById('experiment-tabs');
      const gridContainer = document.getElementById('method-grid');

      // Create Tabs
      experiments.forEach((exp, index) => {
        const btn = document.createElement('button');
        btn.className = `tab-btn ${index === 0 ? 'active' : ''}`;
        btn.textContent = exp.title;
        btn.onclick = () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentExperiment = exp;
          renderGrid();
        };
        tabsContainer.appendChild(btn);
      });

      renderGrid();
    }

    function renderGrid() {
      const gridContainer = document.getElementById('method-grid');
      gridContainer.innerHTML = '';
      gridContainer.style.display = ''; // Reset to default CSS grid

      // Special rendering for robot_2d: show GIFs first, then PNGs
      if (currentExperiment.id === 'robot_2d') {
        renderRobot2DLayout(gridContainer);
        renderGifGallery();
        return;
      }

      currentExperiment.methods.forEach(method => {
        const item = document.createElement('div');
        item.className = 'method-item';
        item.onclick = () => openModal(method);

        const thumbContainer = document.createElement('div');
        thumbContainer.className = 'method-thumb-container';

        const img = document.createElement('img');
        img.className = 'method-thumb';
        // For car experiments, use GIF if available, otherwise use PNG or file
        let imageSrc;
        const isCarExperiment = currentExperiment.id === 'car_forward' || currentExperiment.id === 'car_inverse';
        if (isCarExperiment && method.gif) {
          imageSrc = method.gif;
        } else {
          imageSrc = method.png || (currentExperiment.path + method.file);
        }
        img.src = imageSrc;
        img.alt = method.name;
        
        // Lazy load handling if needed, but standard src is fine for small set
        thumbContainer.appendChild(img);

        // Add State/Action labels for car experiments
        if (isCarExperiment) {
          const labelOverlay = document.createElement('div');
          labelOverlay.className = 'car-label-overlay';
          labelOverlay.innerHTML = '<span class="car-label car-label-left">State</span><span class="car-label car-label-right">Action</span>';
          thumbContainer.appendChild(labelOverlay);
        }

        const nameDiv = document.createElement('div');
        nameDiv.className = 'method-name';
        nameDiv.textContent = method.name;

        item.appendChild(thumbContainer);
        item.appendChild(nameDiv);
        gridContainer.appendChild(item);
      });

      renderGifGallery();
    }

    function renderRobot2DLayout(container) {
      const cacheBust = `?v=${Date.now()}`;
      
      // Override grid layout for robot_2d
      container.style.display = 'block';
      
      // Section 1: GIFs (Action)
      const gifActionTitle = document.createElement('h3');
      gifActionTitle.textContent = 'Action GIFs';
      gifActionTitle.style.cssText = 'width: 100%; margin: 20px 0 10px 0; color: #333;';
      container.appendChild(gifActionTitle);

      const gifActionGrid = document.createElement('div');
      gifActionGrid.className = 'gif-gallery-grid';
      gifActionGrid.style.cssText = 'width: 100%; margin-bottom: 30px;';
      
      currentExperiment.methods.forEach(method => {
        if (method.gifOptions) {
          const actionOpt = method.gifOptions.find(o => o.label === 'Action');
          if (actionOpt) {
            const card = document.createElement('div');
            card.className = 'gif-card';
            card.style.cursor = 'pointer';
            card.onclick = () => openLightbox(actionOpt.src + cacheBust, method.name + ' (Action)');

            const header = document.createElement('div');
            header.className = 'gif-card-header';
            header.textContent = method.name;

            const media = document.createElement('img');
            media.src = actionOpt.src + cacheBust;
            media.alt = method.name + ' Action';
            media.loading = 'lazy';

            card.appendChild(header);
            card.appendChild(media);
            gifActionGrid.appendChild(card);
          }
        }
      });
      container.appendChild(gifActionGrid);

      // Section 2: GIFs (State)
      const gifStateTitle = document.createElement('h3');
      gifStateTitle.textContent = 'State GIFs';
      gifStateTitle.style.cssText = 'width: 100%; margin: 20px 0 10px 0; color: #333;';
      container.appendChild(gifStateTitle);

      const gifStateGrid = document.createElement('div');
      gifStateGrid.className = 'gif-gallery-grid';
      gifStateGrid.style.cssText = 'width: 100%; margin-bottom: 30px;';
      
      currentExperiment.methods.forEach(method => {
        if (method.gifOptions) {
          const stateOpt = method.gifOptions.find(o => o.label === 'State');
          if (stateOpt) {
            const card = document.createElement('div');
            card.className = 'gif-card';
            card.style.cursor = 'pointer';
            card.onclick = () => openLightbox(stateOpt.src + cacheBust, method.name + ' (State)');

            const header = document.createElement('div');
            header.className = 'gif-card-header';
            header.textContent = method.name;

            const media = document.createElement('img');
            media.src = stateOpt.src + cacheBust;
            media.alt = method.name + ' State';
            media.loading = 'lazy';

            card.appendChild(header);
            card.appendChild(media);
            gifStateGrid.appendChild(card);
          }
        }
      });
      container.appendChild(gifStateGrid);

      // Section 3: PNGs
      const pngTitle = document.createElement('h3');
      pngTitle.textContent = 'Metric Figures (PNG)';
      pngTitle.style.cssText = 'width: 100%; margin: 20px 0 10px 0; color: #333;';
      container.appendChild(pngTitle);

      const pngGrid = document.createElement('div');
      pngGrid.className = 'gif-gallery-grid';
      pngGrid.style.cssText = 'width: 100%;';
      
      currentExperiment.methods.forEach(method => {
        if (method.file) {
          const card = document.createElement('div');
          card.className = 'gif-card';
          card.style.cursor = 'pointer';
          const pngSrc = currentExperiment.path + method.file;
          card.onclick = () => openLightbox(pngSrc, method.name + ' (PNG)');

          const header = document.createElement('div');
          header.className = 'gif-card-header';
          header.textContent = method.name;

          const media = document.createElement('img');
          media.src = pngSrc;
          media.alt = method.name + ' PNG';
          media.loading = 'lazy';

          card.appendChild(header);
          card.appendChild(media);
          pngGrid.appendChild(card);
        }
      });
      container.appendChild(pngGrid);
    }

    function renderGifGallery() {
      const galleryContainer = document.getElementById('gif-gallery');
      if (!galleryContainer) return;
      galleryContainer.innerHTML = '';
      galleryContainer.style.display = 'none';

      const gifItems = [];
      currentExperiment.methods.forEach(method => {
        const options = Array.isArray(method.gifOptions)
          ? method.gifOptions
          : (method.gif ? [{ label: 'GIF', src: method.gif }] : []);
        options.forEach(opt => {
          gifItems.push({
            title: `${method.name}`,
            src: opt.src
          });
        });
      });

      if (gifItems.length === 0) return;

      // Hide gif-gallery for car and robot_2d experiments (they already show GIFs in method-grid)
      if (currentExperiment.id === 'car_forward' || currentExperiment.id === 'car_inverse' || currentExperiment.id === 'robot_2d') return;

      const grid = document.createElement('div');
      grid.className = 'gif-gallery-grid';

      const cacheBust = `?v=${Date.now()}`;
      gifItems.forEach(item => {
        const card = document.createElement('div');
        card.className = 'gif-card';
        card.style.cursor = 'pointer';
        card.onclick = () => openLightbox(item.src + cacheBust, item.title);

        const header = document.createElement('div');
        header.className = 'gif-card-header';
        header.textContent = item.title;

        const media = document.createElement('img');
        media.src = item.src + cacheBust;
        media.alt = item.title;
        media.loading = 'lazy';
        media.dataset.base = item.src;

        card.appendChild(header);
        card.appendChild(media);
        grid.appendChild(card);
      });

      galleryContainer.appendChild(grid);
      galleryContainer.style.display = 'grid';
      refreshGalleryGifs();
    }

    // Modal Logic
    const modal = document.getElementById('result-modal');
    const closeBtn = document.querySelector('.close-modal');
    const modalTitle = document.getElementById('modal-title');
    const modalImage = document.getElementById('modal-image');
    const modalGif = document.getElementById('modal-gif-placeholder');
    const toggleBtns = document.querySelectorAll('.toggle-btn');
    const gifToggleBtn = document.querySelector('.toggle-btn[data-type="gif"]');
    let currentMethod = null;
    let currentGifOptions = [];
    let currentGifIndex = 0;

    function openModal(method) {
      currentMethod = method;
      modalTitle.textContent = method.name + ' (' + currentExperiment.title + ')';
      
      currentGifOptions = Array.isArray(method.gifOptions) ? method.gifOptions : (method.gif ? [{ label: 'GIF', src: method.gif }] : []);
      currentGifIndex = 0;

      const supportsGif = currentGifOptions.length > 0 && currentExperiment.id !== 'pendulum' && currentExperiment.id !== 'robot_3d';
      updateGifToggleAvailability(supportsGif);

      // For car experiments, default to GIF view; otherwise default to Image
      if (currentExperiment.id === 'car_forward' || currentExperiment.id === 'car_inverse') {
        setModalView('gif');
      } else {
        setModalView('image');
      }

      modal.classList.add('open');
      document.body.style.overflow = 'hidden'; // Prevent scrolling
    }

    function closeModal() {
      modal.classList.remove('open');
      document.body.style.overflow = '';
    }

    closeBtn.onclick = closeModal;
    window.onclick = (e) => {
      if (e.target === modal) closeModal();
    };

    // Global function for onclick in HTML
    window.setModalView = function(view) {
      if (!currentMethod) return;

      const supportsGif = currentExperiment.id !== 'pendulum' && currentExperiment.id !== 'robot_3d';
      if (view === 'gif' && !supportsGif) return;

      updateToggleUI(view);

      if (view === 'image') {
        // For car experiments, show GIF instead of PNG
        if ((currentExperiment.id === 'car_forward' || currentExperiment.id === 'car_inverse') && currentMethod.gif) {
          modalImage.style.display = 'none';
          modalGif.style.display = 'flex';
          modalGif.innerHTML = `
            <div class="modal-car-container">
              <img src="${currentMethod.gif}" alt="Result GIF" style="max-width:100%; max-height:70vh; object-fit: contain;">
              <div class="modal-car-labels">
                <span class="modal-car-label modal-car-label-left">State</span>
                <span class="modal-car-label modal-car-label-right">Action</span>
              </div>
            </div>`;
        } else {
          modalImage.style.display = 'block';
          modalImage.src = currentMethod.png || (currentExperiment.path + currentMethod.file);
          modalGif.style.display = 'none';
          modalGif.innerHTML = '';
        }
      } else {
        modalImage.style.display = 'none';
        modalGif.style.display = 'flex';
        if (currentGifOptions.length > 0) {
          renderGifOptions();
        } else {
          modalGif.innerHTML = '<div class="placeholder-text">GIF Placeholder</div>';
        }
      }
    };

    function updateToggleUI(view) {
      toggleBtns.forEach(btn => {
        if (btn.textContent.toLowerCase() === view) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    function updateGifToggleAvailability(enabled) {
      if (!gifToggleBtn) return;
      const imageToggleBtn = document.querySelector('.toggle-btn[data-type="image"]');
      const viewToggle = document.querySelector('.view-toggle');
      
      // For car experiments, hide the entire toggle (only show GIF)
      if (currentExperiment.id === 'car_forward' || currentExperiment.id === 'car_inverse') {
        if (viewToggle) viewToggle.style.display = 'none';
      } else {
        if (viewToggle) viewToggle.style.display = 'flex';
        if (enabled) {
          gifToggleBtn.style.display = 'inline-flex';
        } else {
          gifToggleBtn.style.display = 'none';
          modalGif.style.display = 'none';
          modalImage.style.display = 'block';
        }
      }
    }

    function renderGifOptions() {
      if (!currentGifOptions.length) return;
      const buttons = currentGifOptions.map((opt, idx) => `
        <button class="toggle-btn ${idx === currentGifIndex ? 'active' : ''}" onclick="setGifIndex(${idx})" style="margin:0.25rem;">${opt.label}</button>
      `).join('');
      // Remove timestamp to allow GIF to play fully without resetting
      const gifSrc = currentGifOptions[currentGifIndex].src;
      const isCarExperiment = currentExperiment.id === 'car_forward' || currentExperiment.id === 'car_inverse';
      const carLabels = isCarExperiment ? `
        <div class="modal-car-labels">
          <span class="modal-car-label modal-car-label-left">State</span>
          <span class="modal-car-label modal-car-label-right">Action</span>
        </div>` : '';
      modalGif.innerHTML = `
        <div style="display:flex; justify-content:center; gap:0.5rem; flex-wrap:wrap; margin-bottom:0.75rem;">${buttons}</div>
        <div class="modal-car-container">
          <img src="${gifSrc}" alt="Result GIF" style="max-width:100%; max-height:70vh; object-fit: contain;">
          ${carLabels}
        </div>
      `;
    }

    window.setGifIndex = function(idx) {
      if (idx < 0 || idx >= currentGifOptions.length) return;
      currentGifIndex = idx;
      renderGifOptions();
    };

    // Periodically refresh gallery GIFs to keep them animating
    let galleryGifTimer = null;
    function refreshGalleryGifs() {
      if (galleryGifTimer) {
        clearInterval(galleryGifTimer);
        galleryGifTimer = null;
      }
      const imgs = document.querySelectorAll('.gif-card img');
      if (!imgs.length) return;
      const bump = () => {
        imgs.forEach(img => {
          const base = img.dataset.base || img.src.split('?')[0];
          img.src = `${base}?v=${Date.now()}`;
        });
      };
      bump();
      // Increase interval to 15 seconds to allow GIFs to play longer
      galleryGifTimer = setInterval(bump, 15000);
    }

    // Hero GIF carousel (three panes, dedicated sources)
    const heroGifEls = [
      document.getElementById('hero-gif-0'),
      document.getElementById('hero-gif-1'),
      document.getElementById('hero-gif-2'),
    ];
    const heroSources = [
      ['fig/gifs/car_metric/forward/UniConFlow_denoising.gif'],   // slot 0: car forward
      ['fig/gifs/car_metric/reverse/UniConFlow_denoising.gif'],   // slot 1: car reverse
      ['fig/gifs/robot_2D/UniCon_State.gif']                      // slot 2: robot state
    ];
    let heroIndices = [0, 0, 0];
    let heroBaseSrcs = [null, null, null]; // Store base srcs for acceleration
    
    function rotateHeroes() {
      heroGifEls.forEach((el, idx) => {
        if (!el || !heroSources[idx].length) return;
        const list = heroSources[idx];
        const src = list[heroIndices[idx] % list.length];
        heroBaseSrcs[idx] = src; // Store base src
        el.src = `${src}?v=${Date.now()}`;
        heroIndices[idx] = (heroIndices[idx] + 1) % list.length;
      });
    }
    
    // Accelerate GIF playback by refreshing more frequently
    function accelerateHeroGifs() {
      heroGifEls.forEach((el, idx) => {
        if (!el || !heroBaseSrcs[idx]) return;
        // Refresh GIF to restart animation, creating acceleration effect
        const currentSrc = el.src.split('?')[0];
        if (currentSrc === heroBaseSrcs[idx]) {
          el.src = `${heroBaseSrcs[idx]}?v=${Date.now()}`;
        }
      });
    }
    
    rotateHeroes();
    setInterval(rotateHeroes, 13000);
    // Refresh GIFs less frequently to allow longer playback (every 10 seconds)
    setInterval(accelerateHeroGifs, 1000);

    // --- Detailed Results Logic ---
    const detailedData = [
      {
        id: 'pendulum_table',
        title: 'Pendulum',
        headers: ["Method", "SR-S (%) ↑", "SR-A (%) ↑", "AR (%) ↑", "TSR (%) ↑", "KC-F ↓", "KC-I ↓", "Cost ↓", "Time (ms) ↓"],
        rows: [
          ["Diffuser", "86.10", "86.40", "95.53", "83.66", "0.0072 ± 0.0001", "1.1754 ± 0.5041", "535.30 ± 7.52", "<b>1.9</b> ± 0.001"],
          ["Diffuser-D", "86.10", "74.60", "76.27", "69.06", "<b>0.0000</b> ± <b>0.0000</b>", "<b>0.0000</b> ± <b>0.0000</b>", "601.52 ± 202.28", "2.9 ± 0.001"],
          ["Trunc", "86.10", "86.10", "95.92", "83.66", "0.0072 ± 0.0003", "1.1791 ± 0.513", "535.29 ± 155.73", "2.2 ± 0.0001"],
          ["CG", "87.35", "86.70", "91.85", "83.92", "0.0871 ± 0.004", "1.4833 ± 0.692", "536.40 ± 158.60", "133.3 ± 0.001"],
          ["RoS", "87.62", "86.30", "94.28", "84.19", "0.0325 ± 0.008", "1.6783 ± 0.511", "533.67 ± 156.78", "139.9 ± 0.001"],
          ["ReS", "87.62", "85.80", "98.49", "85.19", "0.0325 ± 0.008", "1.1987 ± 0.542", "535.68 ± 179.68", "137.2 ± 0.001"],
          ["TVS", "97.49", "86.10", "98.57", "93.05", "0.0673 ± 0.002", "1.4495 ± 0.583", "532.35 ± 158.08", "140.7 ± 0.001"],
          ["FM", "86.10", "88.94", "99.17", "85.12", "0.0038 ± 0.0003", "1.1768 ± 0.522", "531.76 ± 152.82", "1.7 ± 0.001"],
          ["PCFM", "94.12", "86.30", "92.61", "92.04", "0.0025 ± 0.0004", "1.137 ± 0.342", "522.46 ± 103.8", "8.4 ± 0.001"],
          ["FM-MPPI", "<b>100</b>", "<b>100</b>", "99.97", "99.97", "<b>0.0000</b> ± <b>0.0000</b>", "<b>0.0000</b> ± <b>0.0000</b>", "530.79 ± 311.46", "12.9 ± 0.001"],
          ["SafeFlow", "<b>100</b>", "86.9", "96.07", "82.79", "0.0067 ± 0.003", "1.1347 ± 0.689", "535.18 ± 131.15", "2.2 ± 0.001"],
          ["UniConFlow", "<b>100</b>", "<b>100</b>", "<b>100</b>", "<b>100</b>", "<b>0.0000</b> ± <b>0.000</b>", "<b>0.0000</b> ± <b>0.000</b>", "<b>507.81</b>", "2.6 ± 0.001"]
        ]
      },
      {
        id: 'car_forward_table',
        title: 'Car Racing (Forward)',
        headers: ["Method", "SR-S (%)", "SR-A (%) ↑", "AR (%) ↑", "TSR (%) ↑", "KC-F ↓", "KC-I ↓", "Cost ↓", "Time (ms) ↓"],
        rows: [
          ["Diffuser", "0.00", "0.00", "<b>100.00</b>", "0.00", "40.48 ± 16.23", "5.30 ± 1.09", "99.62 ± 30.52", "2.10 ± 0.0001"],
          ["Diffuser-D", "0.00", "0.00", "93.72", "0.00", "<b>0.0000</b> ± 0.0000", "<b>0.0000</b> ± 0.0000", "423.86 ± 51.21", "2.30 ± 0.0001"],
          ["Trunc", "0.00", "0.00", "<b>100.00</b>", "0.00", "41.16 ± 17.01", "4.96 ± 2.79", "103.27 ± 28.08", "2.10 ± 0.0001"],
          ["CG", "0.00", "0.00", "<b>100.00</b>", "0.00", "53.90 ± 9.14", "4.45 ± 1.57", "123.67 ± 34.57", "286.40 ± 0.0001"],
          ["CoBL", "1.29", "0.00", "<b>100.00</b>", "0.00", "43.44 ± 13.52", "4.71 ± 1.61", "113.26 ± 30.85", "446.70 ± 0.0001"],
          ["RoS", "7.27", "0.00", "<b>100.00</b>", "0.00", "54.70 ± 14.22", "4.27 ± 1.59", "130.71 ± 41.50", "312.10 ± 0.0001"],
          ["ReS", "14.55", "0.00", "<b>100.00</b>", "0.00", "52.63 ± 14.25", "4.73 ± 1.74", "113.59 ± 42.13", "23.90 ± 0.0001"],
          ["TVS", "34.55", "0.00", "<b>100.00</b>", "0.00", "60.19 ± 12.60", "4.17 ± 1.51", "138.10 ± 43.59", "314.10 ± 0.0001"],
          ["FM", "0.00", "0.00", "<b>100.00</b>", "0.00", "45.64 ± 13.03", "5.72 ± 1.03", "97.34 ± 22.18", "<b>2.08</b> ± 0.0001"],
          ["PCFM", "0.00", "0.02", "0.00", "0.00", "37.17 ± 11.32", "5.17 ± 1.51", "108.81 ± 25.47", "180000.00"],
          ["FM-MPPI", "0.00", "0.00", "0.00", "0.00", "22.06 ± 9.90", "3.19 ± 0.64", "66731.02 ± 346.72", "180000.00"],
          ["SafeFlow", "<b>100.00</b>", "0.00", "<b>100.00</b>", "0.00", "54.83 ± 16.47", "7.29 ± 0.90", "98.84 ± 19.87", "2.60 ± 0.0001"],
          ["UniConFlow", "<b>100.00</b>", "<b>100.00</b>", "<b>100.00</b>", "<b>100.00</b>", "<b>0.0000</b> ± <b>0.0000</b>", "<b>0.0000</b> ± <b>0.0000</b>", "<b>63.79</b> ± 15.27", "2.70 ± 0.0001"]
        ]
      },
      {
        id: 'car_reverse_table',
        title: 'Car Racing (Reverse)',
        headers: ["Method", "SR-S (%)", "SR-A (%) ↑", "AR (%) ↑", "TSR (%) ↑", "KC-F ↓", "KC-I ↓", "Cost ↓", "Time (ms) ↓"],
        rows: [
          ["Diffuser", "0.00", "0.00", "<b>100.00</b>", "0.00", "26.29 ± 12.33", "4.53 ± 2.84", "126.59 ± 27.34", "2.90 ± 0.0001"],
          ["Diffuser-D", "0.00", "0.00", "91.22", "0.00", "<b>0.0000</b> ± 0.0000", "<b>0.0000</b> ± 0.0000", "348.22 ± 79.85", "3.00 ± 0.0001"],
          ["Trunc", "0.91", "0.00", "<b>100.00</b>", "0.00", "24.74 ± 17.17", "4.55 ± 2.76", "129.77 ± 33.11", "2.90 ± 0.0001"],
          ["CG", "0.00", "0.00", "<b>100.00</b>", "0.00", "23.95 ± 6.29", "4.05 ± 1.57", "132.74 ± 28.57", "178.40 ± 0.0001"],
          ["RoS", "0.00", "0.00", "<b>100.00</b>", "0.00", "24.50 ± 17.73", "4.03 ± 1.59", "137.03 ± 27.88", "177.30 ± 0.0001"],
          ["ReS", "0.91", "0.00", "<b>100.00</b>", "0.00", "26.58 ± 11.34", "3.97 ± 1.74", "133.89 ± 28.39", "18.90 ± 0.0001"],
          ["TVS", "66.36", "0.00", "<b>100.00</b>", "0.00", "27.94 ± 15.97", "3.70 ± 1.51", "138.27 ± 40.58", "178.20 ± 0.0001"],
          ["CoBL", "0.00", "0.00", "<b>100.00</b>", "0.00", "26.23 ± 19.90", "4.04 ± 1.61", "149.15 ± 27.56", "449.10 ± 0.0001"],
          ["FM", "0.00", "0.00", "<b>100.00</b>", "0.00", "42.81 ± 11.52", "4.59 ± 2.01", "121.18 ± 23.84", "2.80 ± 0.0001"],
          ["PCFM", "0.00", "0.05", "0.00", "0.00", "37.17 ± 8.18", "4.32 ± 1.00", "109.11 ± 21.02", "180000.00 ± 0.0001"],
          ["FM-MPPI", "0.00", "0.00", "0.00", "0.00", "20.59 ± 5.21", "36.92 ± 15.90", "63242.24 ± 981.17", "180000.00 ± 0.0001"],
          ["SafeFlow", "<b>100.00</b>", "0.00", "<b>100.00</b>", "0.00", "32.71 ± 10.06", "5.42 ± 1.98", "107.73 ± 35.81", "3.30 ± 0.0001"],
          ["UniConFlow", "<b>100.00</b>", "<b>100.00</b>", "<b>100.00</b>", "<b>100.00</b>", "<b>0.0000</b> ± <b>0.0000</b>", "<b>0.0000</b> ± <b>0.0000</b>", "<b>64.21</b> ± 10.73", "<b>2.50</b> ± 0.0001"]
        ]
      },
      {
        id: 'robot_2d_table',
        title: 'Manipulator (Pseudo-2D)',
        headers: ["Method", "SR-S (%)", "SR-A (%) ↑", "AR (%) ↑", "TSR (%) ↑", "KC-F ↓", "KC-I ↓", "Cost ↓", "Time (ms) ↓"],
        rows: [
          ["Diffuser", "86.29", "0.00", "100.00", "0.00", "2057.94 ± 59.74", "37.09 ± 2.91", "≈ 1.66 × 10¹¹", "27.00 ± 0.02"],
          ["Diffuser-D", "86.36", "0.00", "100.00", "0.00", "2057.89 ± 51.97", "37.08 ± 7.24", "≈ 1.66 × 10¹¹", "28.00 ± 0.08"],
          ["Trunc", "100.00", "0.00", "100.00", "0.00", "1228.73 ± 36.21", "35.36 ± 8.17", "≈ 1.25 × 10¹⁰", "59.91 ± 1.76"],
          ["CG", "95.84", "0.00", "100.00", "0.00", "2059.33 ± 32.49", "37.08 ± 26.42", "≈ 3.62 × 10¹⁰", "4439.57 ± 0.02"],
          ["RoS", "94.51", "0.00", "100.00", "0.00", "2059.94 ± 36.84", "37.08 ± 2.55", "≈ 3.62 × 10¹⁰", "4435.32 ± 0.04"],
          ["ReS", "97.78", "0.00", "100.00", "0.00", "2059.05 ± 29.66", "37.08 ± 4.75", "≈ 3.62 × 10¹⁰", "4462.81 ± 0.03"],
          ["TVS", "93.39", "0.00", "100.00", "0.00", "2064.39 ± 32.14", "37.07 ± 5.17", "≈ 3.62 × 10¹⁰", "6491.22 ± 0.01"],
          ["CoBL", "92.79", "0.00", "100.00", "0.00", "2059.60 ± 30.76", "37.08 ± 6.12", "≈ 3.66 × 10¹⁰", "586.35 ± 0.01"],
          ["FM", "86.07", "0.00", "100.00", "0.00", "2056.43 ± 38.75", "37.21 ± 2.88", "≈ 1.66 × 10¹¹", "26.00 ± 0.02"],
          ["PCFM", "91.02", "0.02", "0.00", "0.00", "37.17 ± 32.79", "5.17 ± 1.82", "≈ 5.65 × 10⁹", "> 180000.00"],
          ["FM-MPPI", "82.17", "0.00", "0.00", "0.00", "<b>0.0000</b> ± 0.00", "<b>0.0000</b> ± 0.00", "≈ 3.72 × 10⁹", "> 180000.00"],
          ["SafeFlow", "<b>100.00</b>", "<b>100.00</b>", "<b>100.00</b>", "<b>100.00</b>", "2069.25 ± 21.85", "33.50 ± 1.08", "≈ 1.62 × 10¹⁰", "35.00 ± 0.02"],
          ["UniConFlow", "<b>100.00</b>", "<b>100.00</b>", "<b>100.00</b>", "<b>100.00</b>", "<b>0.0000</b> ± 0.00", "<b>0.0000</b> ± 0.00", "<b>64.79</b> ± 15.72", "<b>32.00</b> ± 2.16"]
        ]
      },
      {
        id: 'robot_3d_table',
        title: 'Manipulator (3D)',
        headers: ["Method", "SR-S (%)", "SR-A (%) ↑", "AR (%) ↑", "TSR (%) ↑", "KC-F ↓", "KC-I ↓", "Cost ↓", "Time (ms) ↓"],
        rows: [
          ["Diffuser", "0.00", "0.00", "100.00", "0.00", "692.44 ± 2.43", "0.057 ± 0.048", "≈ 1.17 × 10⁷", "103.3 ± 0.7"],
          ["Diffuser-D", "0.00", "0.00", "100.00", "0.00", "0.00 ± 0.00", "0.00 ± 0.00", "≈ 1.18 × 10⁶", "103.4 ± 0.9"],
          ["Trunc", "100.0", "7.02", "100.00", "7.02", "55.93 ± 28.76", "0.083 ± 0.098", "≈ 2.37 × 10⁷", "24.5 ± 7.4"],
          ["CG", "12.30", "0.00", "100.00", "0.00", "692.37 ± 2.64", "0.060 ± 0.051", "≈ 1.19 × 10⁷", "102.9 ± 0.5"],
          ["RoS", "7.02", "0.00", "100.00", "0.00", "677.34 ± 2.44", "0.062 ± 0.031", "≈ 1.17 × 10⁷", "107.1 ± 0.2"],
          ["ReS", "3.95", "0.00", "100.00", "0.00", "689.28 ± 2.54", "0.053 ± 0.044", "≈ 1.16 × 10⁷", "107.6 ± 0.1"],
          ["TVS", "8.81", "0.00", "100.00", "0.00", "693.66 ± 2.35", "0.048 ± 0.041", "≈ 1.18 × 10⁷", "106.9 ± 0.1"],
          ["FM", "0.00", "0.00", "100.00", "0.00", "692.81 ± 2.32", "0.052 ± 0.012", "≈ 1.16 × 10⁷", "102.7 ± 0.7"],
          ["PCFM", "0.00", "0.05", "0.00", "0.00", "463.13 ± 1.23", "0.039 ± 0.021", "≈ 7.12 × 10⁵", "> 180000.00"],
          ["FM-MPPI", "0.00", "0.00", "0.00", "0.00", "513.97 ± 2.01", "0.021 ± 0.004", "≈ 3.51 × 10⁷", "> 180000.00"],
          ["SafeFlow", "<b>100.00</b>", "0.00", "<b>100.00</b>", "0.00", "704.90 ± 1.18", "0.061 ± 0.017", "≈ 1.59 × 10⁷", "108.1 ± 0.3"],
          ["UniConFlow", "<b>100.00</b>", "<b>100.00</b>", "<b>100.00</b>", "<b>100.00</b>", "<b>0.0000</b>", "<b>0.0000</b>", "783.95 ± 12.98", "<b>105.8</b> ± 0.2"]
        ]
      }
    ];

    function initDetailedResults() {
      const tabsContainer = document.getElementById('detailed-tabs');
      const tableContainer = document.getElementById('table-container');

      // Create Tabs
      detailedData.forEach((table, index) => {
        const btn = document.createElement('button');
        btn.className = `tab-btn ${index === 0 ? 'active' : ''}`;
        btn.textContent = table.title;
        btn.onclick = () => {
          document.querySelectorAll('#detailed-tabs .tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderTable(table);
        };
        tabsContainer.appendChild(btn);
      });

      renderTable(detailedData[0]);
    }

    function renderTable(tableData) {
      const container = document.getElementById('table-container');
      
      let html = `<div class="table-responsive">
        <table class="detailed-table" id="active-table">
          <thead>
            <tr>`;
      
      tableData.headers.forEach(h => {
        html += `<th>${h}</th>`;
      });
      
      html += `</tr>
          </thead>
          <tbody>`;
      
      tableData.rows.forEach(row => {
        html += `<tr>`;
        row.forEach(cell => {
          html += `<td>${cell}</td>`;
        });
        html += `</tr>`;
      });
      
      html += `</tbody>
        </table>
      </div>`;
      
      container.innerHTML = html;
      initTableHighlight();
    }

    function initTableHighlight() {
      const table = document.getElementById('active-table');
      if (!table) return;

      const cells = table.getElementsByTagName('td');
      const headers = table.getElementsByTagName('th');
      
      for (let i = 0; i < cells.length; i++) {
        const cell = cells[i];
        
        cell.addEventListener('mouseover', function() {
          const row = this.parentElement;
          const rowIndex = row.rowIndex;
          const colIndex = this.cellIndex;

          // Highlight Row
          row.classList.add('hover-row');
          
          // Highlight Column
          // 1. Highlight header
          if (headers[colIndex]) headers[colIndex].classList.add('hover-col');
          
          // 2. Highlight other cells in same column
          const allRows = table.getElementsByTagName('tr');
          for (let j = 0; j < allRows.length; j++) {
            const cellsInRow = allRows[j].getElementsByTagName('td');
            if (cellsInRow[colIndex]) {
              cellsInRow[colIndex].classList.add('hover-col');
            }
          }
          
          // Highlight Cell
          this.classList.add('hover-cell');
        });

        cell.addEventListener('mouseout', function() {
          const row = this.parentElement;
          const colIndex = this.cellIndex;

          // Remove Highlight Row
          row.classList.remove('hover-row');
          
          // Remove Highlight Column
          if (headers[colIndex]) headers[colIndex].classList.remove('hover-col');
          
          const allRows = table.getElementsByTagName('tr');
          for (let j = 0; j < allRows.length; j++) {
            const cellsInRow = allRows[j].getElementsByTagName('td');
            if (cellsInRow[colIndex]) {
              cellsInRow[colIndex].classList.remove('hover-col');
            }
          }
          
          // Remove Highlight Cell
          this.classList.remove('hover-cell');
        });
      }
    }

    // Initialize Detailed Results
    initDetailedResults();

    // Initialize Qualitative Results
    initQualitative();

    // --- Lightbox for Demo Images ---
    const lightboxModal = document.getElementById('lightbox-modal');
    const lightboxImage = document.getElementById('lightbox-image');
    const lightboxTitle = document.getElementById('lightbox-title');
    const lightboxClose = document.getElementById('lightbox-close');

    window.openLightbox = function(src, title = '') {
      lightboxImage.src = src;
      lightboxTitle.textContent = title;
      lightboxModal.classList.add('open');
      document.body.style.overflow = 'hidden';
    };

    function closeLightbox() {
      lightboxModal.classList.remove('open');
      document.body.style.overflow = '';
    }

    lightboxClose.onclick = closeLightbox;
    window.addEventListener('click', (e) => {
      if (e.target === lightboxModal) closeLightbox();
    });
  </script>
</body>
</html>
